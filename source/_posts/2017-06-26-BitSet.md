---
title: BitSet 类
tags:
  - java
date: 2017-06-26 15:37:22
categories: 笔记
---

[BitSet](https://developer.android.com/reference/java/util/BitSet.html)

[BitSet to and from integer/long](BitSet to and from integer/long)

​	BitSet 实现了一个可以自动增长的 bit 数组（以给定的大小创建，在溢出时增长，增长以翻倍方式进行），其每一 bit 位都有一个 boolean 值。BitSet 会为每一个 bit 设置非负的索引，每一个索引位都可以独立进行**检测**、**设置**、**清除**。BitSet 中每一位的值默认为 false。

​	BitSet 的构造函数有：

```java
    /**
     * 默认构造函数得到的 BitSet 初始大小为64bit
     */
    public BitSet() {
        this(new long[1]);
    }

    /**
     *  指定 bit 数目，BitSet 在构造时数据存储的 bit 数仍为64的倍数
     */
    public BitSet(int bitCount) {
        if (bitCount < 0) {
            throw new NegativeArraySizeException(Integer.toString(bitCount));
        }
        this.bits = arrayForBits(bitCount);
        this.longCount = 0;
    }
```

### BitSet 分析

​	BitSet 将 bit 数据存储在一个 long[] 类型的 words 变量中，每一个 word 为64个 bit（即一个 long 的长度），words 的增长是以翻倍的形式进行。

​	BitSet 的大小：BitSet 有一个“逻辑大小”的概念，BitSet 中有一个 wordsInUse 的 int 变量，其值表示的是 words 中最后一个非 0L 值前面的 word 的数目，BitSet 的 isEmpty() 方法正是根据该值来进行判断，即判断 empty 时与 words 是否为 null 或其 length 是否为 0 无关。 BitSet 中还有一个 length() 方法，该方法得到的也是“逻辑大小”，即最后一个置1的 bit 前所有 bit 的数目，size() 方法才是真正计算 words 大小的方法。

​	BitSet 提供了一系列单独操作每一个 bit 或者指定区间内的 bits 的方法，这些操作包括：置位、清除、取反、检测。两个 BitSet 之间也可以进行逻辑运行：与、或、异或、与非。

​	BitSet 还包含了其他一些方便的方法：cardinality()为 true 的 bit 的数目；intersects(BitSet set)两个 BitSet 是否有同时为 true 的 bit；valueOf(…)等将指定类型转为 BitSet；toLongArray()等将 BitSet 转为其他类型。

### int 与 BitSet 互转

示例代码：

```java
int n = 12345;
BitSet bs = BitSet.valueOf(new long[]{n});
long l = bs.toLongArray()[0];
```
需要注意的是，传给 valueOf 的 long[] 的值不能全为0，否则将发生错误，因为 valueOf 在处理时，会先清理“左侧”为 0L 的值来得到一个最高位不是0L 的 long[]，再进行 BitSet 的构建。