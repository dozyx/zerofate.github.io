---
title: File 类的使用
tags:
  - java
date: 2017-02-23 15:37:22
categories: 笔记
---

## getPath() getAbsolutePath() 和getCanonicalPath()

[What's the difference between getPath(), getAbsolutePath(), and getCanonicalPath() in Java?](http://stackoverflow.com/questions/1099300/whats-the-difference-between-getpath-getabsolutepath-and-getcanonicalpath)

`new File"abc.text"`

打印结果

> file1.getPath() == abc.txt
> file1.getAbsolutePath() == D:\workspace\JavaTest\abc.txt
> file1.getCanonicalPath() == D:\workspace\JavaTest\abc.txt

`new File("../test/abc.txt")`

打印结果

> file1.getPath() == ..\test\abc.txt
> file1.getAbsolutePath() == D:\workspace\JavaTest\..\test\abc.txt
> file1.getCanonicalPath() == D:\workspace\test\abc.txt

`workspace`是eclipse的工作目录，`JavaTest`是创建的工程。分析打印结果，可以知道，getPath()得到的是生成File对象时的路径，getAbsolutePath()得到的是指向文件的一个绝对路径，而getCanonicalPath()得到的是指向文件的==**唯一**==的绝对路径（**指向同一文件的absolute路径会有多个，但只有一个是canonical路径**）。

> An absolute path is one that begins at the root of the file system.
>
> A canonical path is an absolute path with symbolic links and references to "." or ".." resolved. 

大多数情况下应该使用getAbsolutePath()，因为计算canonical路径昂贵得多。canonical路径主要用于比较两个路径是否指向同一个文件。



## CreateTempFile()

​	用于在给定目录创建空的临时文件，并以指定的前缀和后缀作为文件的一部分。如果后缀为null，则使用`.tmp`。最后生成的文件名如test61242899.3gp，其中的数字也可能为负。

> CreateTempFile(...)并不会调用deleteOnExit()

​	实现源码：

```java
public static File createTempFile(String prefix, String suffix, File directory)
            throws IOException {
        // Force a prefix null check first
        if (prefix.length() < 3) {
            throw new IllegalArgumentException("prefix must be at least 3 characters");
        }
        if (suffix == null) {
            suffix = ".tmp";
        }
        File tmpDirFile = directory;
        if (tmpDirFile == null) {
            String tmpDir = System.getProperty("java.io.tmpdir", ".");
            tmpDirFile = new File(tmpDir);
        }
        File result;
        do {
            result = new File(tmpDirFile, prefix + tempFileRandom.nextInt() + suffix);
        } while (!result.createNewFile());
        return result;
    }
```

如果directory为null，将使用系统属性`java.io.tmpdir`指定的目录，在某个设备上打印出来的路径为

`02-24 14:09:34.349: D/test(6376): temp path == /data/data/com.lsl.myapplication/cache`



​	附：deleteOnExit方法说明

```java
/**
     * Schedules this file to be automatically deleted when the VM terminates normally.
     *
     * <p><i>Note that on Android, the application lifecycle does not include VM termination,
     * so calling this method will not ensure that files are deleted</i>. Instead, you should
     * use the most appropriate out of:
     * <ul>
     * <li>Use a {@code finally} clause to manually invoke {@link #delete}.
     * <li>Maintain your own set of files to delete, and process it at an appropriate point
     * in your application's lifecycle.
     * <li>Use the Unix trick of deleting the file as soon as all readers and writers have
     * opened it. No new readers/writers will be able to access the file, but all existing
     * ones will still have access until the last one closes the file.
     * </ul>
     */
    public void deleteOnExit() {
        DeleteOnExit.getInstance().addFile(getAbsolutePath());
    }
```