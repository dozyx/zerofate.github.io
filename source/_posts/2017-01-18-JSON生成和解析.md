---
title: JSON 使用
tags:
  - android
date: 2017-01-18 15:37:22
categories: 笔记
---

[W3School JSON 教程](http://www.w3school.com.cn/json/index.asp)

[JSON中的get和opt方法的区别](http://blog.csdn.net/u013040819/article/details/72566277)

[JSONObject](https://developer.android.com/reference/org/json/JSONObject.html)

## JSON简介

​	JavaScript 对象表示法，JavaScript Object Notation。jSON比 XML更小、更快、更易解析，json 文件的后缀为 .json 。

实例：

```json
{
	"employees": [
		{ "firstName":"Bill" , "lastName":"Gates" },
		{ "firstName":"George" , "lastName":"Bush" },
		{ "firstName":"Thomas" , "lastName":"Carter" }
	]
}
```

### 语法

JSON 语法是 JavaScript 语法的子集。

- 数据在名称/值对中
- 数据由逗号分隔
- 花括号保存对象
- 方括号保存数组



**JSON 值可以是以下类型：**

- 数字（整数或浮点数）
- 字符串（在双引号中）
- 逻辑值（true 或 false）
- 数组（在方括号中）
- 对象（在花括号中）
- null



## Android 解析 JSON 数据

在 Android 中对 JSON 数据进行解析，一般有两种方法：标准的 API 和谷歌出品的 GSON 开源库。

### 标准 API

​	Android 中与 JSON 相关的类存放在org.json包下面。其中主要有四个类：

+ [JSONArray](https://developer.android.com/reference/org/json/JSONArray.html)

  JSON 数组，它的值可能是 JSONObjects、 JSONArrays、Strings、Booleans、Integers、Longs、Doubles、null 或者 JSONObject.NULL的混合。

+ [JSONObject](https://developer.android.com/reference/org/json/JSONObject.html)

  一个名称/值映射。名称是唯一的非空字符串，值可能是 JSONObjects、 JSONArrays、Strings、Booleans、Integers、Longs、Doubles、null 或者 JSONObject.NULL的混合。

+ [JSONStringer](https://developer.android.com/reference/org/json/JSONStringer.html)

  用于实现 JSONArray 和 JSONObject 的 toString 方法。该类没有提供具有缩进的输入，但通过 JSONArray 和 JSONObject 的 toString(int) 方法可以在调试时打印出可读性更好的信息，int 表示缩进量。

+ [JSONTokener](https://developer.android.com/reference/org/json/JSONTokener.html)

  将JSON 解析为相应的对象（JSON 对象或 JSON 数组），大多数情况下，只需要构建该对象，然后调用nextValue() 方法即可解析数据。

> 注意：JSONArray 和 JSONObject 有两种互不相干的方式来表示 null，一种是标准的 java 的 null 引用，另一种是JSONObject.NULL。对于 JSONArray，get 会因为null 引用而失败，但 JSONObject.NULL 不会；而对于 JSONObject，put(name, null)会将该名称的入口移除，put(name, JSONObject.NULL) 却会将 JSONObject.NULL 作为一个值存储起来。



### getType()  和 optType() 

​	JSONObject 提供了两类方法来获取值：

+ getType()：强制性获取，如果请求的键没有值或者值的类型错误，将抛出异常


+ optType() ：可选值，如果请求的键没有值或者值的类型错误，将使用默认值



#### 示例

```Json
{"daily_forecast": [
    {
        "date": "2016-08-08",
        "cond": {"txt_d": "阵雨"},
        "tmp": {
            "max": "34",
            "min": "27"
        }
    },
    {
        "date": "2016-08-09",
        "cond": {"txt_d": "多云"},
        "tmp": {
            "max": "35",
            "min": "29"
        }
    }
]}
```

##### 生成 JSON

```java
		JSONObject forcastObject = new JSONObject();
        JSONArray forecasts = new JSONArray();
        JSONObject forecast1 = new JSONObject();
        try {
            forecast1.put("date", "2016-08-08");
            JSONObject condObject = new JSONObject();
            condObject.put("txt_d", "阵雨");
            forecast1.put("cond", condObject);
            JSONObject tmpObject = new JSONObject();
            tmpObject.put("max", "34");
            tmpObject.put("min", "27");
            forecast1.put("tmp", tmpObject);
        } catch (JSONException e) {
            e.printStackTrace();
        }
        JSONObject forecast2 = new JSONObject();
        try {
            forecast2.put("date", "2016-08-09");
            JSONObject condObject = new JSONObject();
            condObject.put("txt_d", "多云");
            forecast2.put("cond", condObject);
            JSONObject tmpObject = new JSONObject();
            tmpObject.put("max", "35");
            tmpObject.put("min", "29");
            forecast2.put("tmp", tmpObject);
        } catch (JSONException e) {
            e.printStackTrace();
        }
        forecasts.put(forecast1);
        forecasts.put(forecast2);
        try {
            forcastObject.put("daily_forecast",forecasts);
            Log.d(TAG,"json string == " + forcastObject.toString(4));
        } catch (JSONException e) {
            e.printStackTrace();
        }
```

最后的打印结果为

<img src="/Users/zero/OneDrive/markdown/photo/json/JSONObject 生成 JSON.png" style="zoom:50%" />

##### 解析 JSON 

```java
		try {
            JSONObject jsonObject = new JSONObject(forcastObject.toString(4));
            JSONArray jsonArray = jsonObject.getJSONArray("daily_forecast");
            JSONObject firstObjectOfArray = jsonArray.getJSONObject(0);
            Log.d(TAG,"date == " + firstObjectOfArray.getString("date"));
        } catch (JSONException e) {
            e.printStackTrace();
        }
```

打印结果

```
D/MainActivity: date == 2016-08-08
```

说明读取数据正确

### GSON

​	GSON 使 JSON 得解析变得更为简单，代码量也更少，尤其是在JSON 数据复杂的情况，并且可以直接将 JSON 对象映射为 Java 对象，因此，在使用 GSON 时，我们需要创建对应的 model 类来实现这种映射。在 Android Studio中，有一个 GSONFormat 插件，可以自动根据 json 结构数据，自动生成 model 类。

#### 示例

```json
{"daily_forecast": [
    {
        "date": "2016-08-08",
        "cond": {"txt_d": "阵雨"},
        "tmp": {
            "max": "34",
            "min": "27"
        }
    },
    {
        "date": "2016-08-09",
        "cond": {"txt_d": "多云"},
        "tmp": {
            "max": "35",
            "min": "29"
        }
    }
]}
```

 在使用 GSON 时，我们需要创建一系列对应的 model 类，用于将 JSON 对象映射为 Java 对象。

根据上面的 json，我们可以创建一个model 类 Forecast。（Forecast 的内部类也可以单独定义在其他文件中）

```
public class Forecast {
    public String date;
    @SerializedName("tmp")
    public Temperature temperature;
    @SerializedName("cond")
    public More more;

    public class Temperature {
        public String max;
        public String min;
    }

    public class More {
        @SerializedName("txt_d")
        public String info;
    }
}
```

##### 生成 JSON

在这里我将 Forecast 类拆分为两个model类

```java
public class Forecast {
    @SerializedName("daily_forecast")
    List<DailyForecast> list;
}
public class DailyForecast {
    String date;
    Cond cond;
    Tmp tmp;

    public DailyForecast(String date, String condValue, String max, String min) {
        this.date = date;
        cond = new Cond();
        cond.text = condValue;
        tmp = new Tmp();
        tmp.maxTmp = max;
        tmp.minTmp = min;

    }

    public class Cond {
        @SerializedName("txt_d")
        String text;
    }

    public class Tmp {
        @SerializedName("max")
        String maxTmp;
        @SerializedName("min")
        String minTmp;
    }

}
```

 转为 json

```json
		Gson gson = new Gson();
        Forecast forecast = new Forecast();
        forecast.list = new ArrayList<>();
        forecast.list.add(new DailyForecast("2016-08-08","阵雨","34","27"));
        forecast.list.add(new DailyForecast("2016-08-09","多云","35","29"));
        String json = gson.toJson(forecast);
        Log.d(TAG,"json == " + json.toString());
```

打印结果也是正确的

```
D/MainActivity: json == {"daily_forecast":[{"cond":{"txt_d":"阵雨"},"date":"2016-08-08","tmp":{"max":"34","min":"27"}},{"cond":{"txt_d":"多云"},"date":"2016-08-09","tmp":{"max":"35","min":"29"}}]}
```

##### 解析 JSON

```java
		String json = "{\"daily_forecast\":[{\"date\":\"2016-08-08\",\"cond\":{\"txt_d\":\"阵雨\"},"
                + "\"tmp\":{\"max\":\"34\",\"min\":\"27\"}},{\"date\":\"2016-08-09\","
                + "\"cond\":{\"txt_d\":\"多云\"},\"tmp\":{\"max\":\"35\",\"min\":\"29\"}}]}";
        Gson gson = new Gson();
        Forecast forecast = gson.fromJson(json,Forecast.class);
        Log.d(TAG,"forecast second date == " + forecast.list.get(1).tmp.maxTmp);
```

打印结果正确

```
D/MainActivity: forecast second date == 35
```