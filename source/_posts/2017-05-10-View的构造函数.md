---
title: View 的构造函数
tags:
  - android
date: 2017-05-10 15:37:22
categories: 笔记
---

View 的构造函数有三个：

public View(Context context, AttributeSet attrs)

public View(Context context, AttributeSet attrs, int defStyleAttr) 

public View(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes)

除此三个之外，在源码中还有一个无参构造函数，不过未公开，仅用于测试。在View里，前两个构造函数实际上都是调用了第三个构造函数

```java
public View(Context context, AttributeSet attrs) {
    this(context, attrs, 0);
}
public View(Context context, AttributeSet attrs, int defStyleAttr) {
    this(context, attrs, defStyleAttr, 0);
}
```

当一个 view 对象从 xml 中进行构造时，使用的是第一个具有两个参数的构造函数。

第三个构造函数可以在构造过程中根据主题属性或者 style 资源指定一个基本的风格。一个属性使用哪个值，将按以下优先级选择：

+ AttributeSet 的属性值
+ AttributeSet 中自定的style 资源（名称为“style”）
+ defStyleAttr 中指定的默认风格
+ defStyleRes 中指定的默认风格
+ 主题中的基本值



**参数**

+ attrs 表示的是从 xml 标签中的属性

+ defStyleAttr 表示的是当前主题中的一个属性，该属性引用了一个为view提供默认值的 style 资源，如 TextView 的构造函数就提供了一个用于应用默认 style 的属性

  ```java
  public TextView(Context context, AttributeSet attrs) {
          this(context, attrs, com.android.internal.R.attr.textViewStyle);
      }
  ```

+ defStyleRes 表示的是一个 style 资源的 id



**获取属性值**

属性值是先通过使用构造方法中传入的参数得到一个 TypedArray 对象，然后再通过这个对象读值。如 View:

```java
final TypedArray a = context.obtainStyledAttributes(
                attrs, com.android.internal.R.styleable.View, defStyleAttr, defStyleRes);
```

View中读取的属性都是在View styleable中定义的属性，然后通过 a.getDrawable、a.getFloat等方法获取指定属性的值。

context.obtainStyleAttributes 调用的实际是 Resources.Theme的obtainStyleAttributes 方法：

```java
public TypedArray obtainStyledAttributes(AttributeSet set,
                int[] attrs, int defStyleAttr, int defStyleRes)
```

其中，attrs 指定的就是将要获取值的属性。
