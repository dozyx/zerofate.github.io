---
title: Git - 合并与冲突解决
tags:
  - git
date: 2017-08-25 20:06:36
categories: Git
---

### 场景

git 仓库中有一个分支 master，然后新建一个 work 分支实现新需求，这时候，需要紧急修复一个问题，于是新建一个 hotfix 分支，问题完成后，将 hotfix 合并到 master，然后继续 work 分支的工作，work 结束后，在将 work 合并到 master 时，如果 work 和 hotfix 修改了同一个文件，那么将发生冲突



### 演示

(下面的演示只在本地进行了尝试，远程仓库类似)

首先，创建一个 test 仓库

```shell
$ mkdir test
$ cd test
$ git init
```

创建一个 abc 文件，并编辑内容，保存，提交

```Shell
$ touch abc
$ vim abc
...(进行编辑，也可以不用 vim 而直接使用编辑器修改 abc 内容)
$ git add -A
$ git commit -m "master,创建 abc"
```

> 此时内容（#1）：
>
> master 初始内容 
> aaaaaaaaaaaaaa
> aaaaaaaaaaaaaa

创建一个 work 分支，并改动 abc 文件内容，并进行提交（需要注意，这里如果没有提交修改将直接切换到 master 的话，将导致 master 的工作区域与检出的存在差异，即未提交的修改将保留到 master 工作区域中），但没有合并到 master

```Shell
$ git checkout -b work
$ vim abc
...(编辑 abc 文件)
$ git commit -a -m "work 第一次修改 abc " 
```

> abc 内容修改为（#2）：
>
> master 初始内容
> aaaaaaaaaaaaaa
> aaaaaaaaaaaaaa
> work 添加内容
> bbbbbbbbbbbbbb
> bbbbbbbbbbbbbb

接着，接到紧急需要紧急处理的问题，我们先切回 master，然后新建 hotfix 分支来处理问题，并提交修改

```Shell
$ git checkout master
$ git checkout -b hotfix
$ vim abc
...(编辑 abc 文件)
$ git commit -a -m "hotfix 修改 abc"
```

> abc 内容为（#3）：
>
> master 初始内容
> aaaaaaaaaaaaaa
> aaaaaaaaaaaaaa
> hotfix 添加内容（注意这里没有 work 分支添加的内容，因为 work 没有合并到 master）
> cccccccccccccc
> cccccccccccccc

问题解决后，切换 master，将 hotfix 合并到 master，然后删除 hotfix，继续回到 work 分支继续开发

```shell
$ git checkout master
$ git merge hotfix
# 这里查看 log 将能看到 hotfix 提交的日志
$ git branch -d hotfix
$ git checkout work
# 这里查看 log 是没有 hotfix 提交的日志的，只有上次在 work 分支提交的日志
```

继续编辑 abc，然后提交

```shell
$ vim abc
...(编辑 abc 内容)
$ git commit -a -m "work,第二次修改 abc"
```

> abc 内容（#4，这里我特意使用了与 hotfix 中相同的字母）：
>
> master 初始内容
> aaaaaaaaaaaaaa
> aaaaaaaaaaaaaa
> work 添加内容
> bbbbbbbbbbbbbb
> bbbbbbbbbbbbbb
> work 第二次添加内容
> cccccccccccccc
> cccccccccccccc

接着合并到 master

```shell
$ git checkout master
$ git merge work
```

因为存在冲突，将导致合并失败，使用 git status 将可以看到如下信息（在 merge 被修改之前将无法切换到其他分支）

```shell
On branch master
You have unmerged paths.
  (fix conflicts and run "git commit")
  (use "git merge --abort" to abort the merge)

Unmerged paths:
  (use "git add <file>..." to mark resolution)

	both modified:   abc

no changes added to commit (use "git add" and/or "git commit -a")
```

这时候我们查看 abc 内容如下

> master 初始内容
> aaaaaaaaaaaaaa
> aaaaaaaaaaaaaa
> {% raw %}<<<<<<< HEAD {% endraw %}
> hotfix 添加内容（注意这里没有 work 分支添加的内容，因为 work 没有合并到 master）
> {% raw %}======= {% endraw %}
> work 添加内容
> bbbbbbbbbbbbbb
> bbbbbbbbbbbbbb
> work 第二次添加内容
> {% raw %}> > > > > > >{% endraw %} work
> cccccccccccccc
> cccccccccccccc

执行 merger 命令后冲突的 abc 文件同时显示了两个文件的差异内容，这时候我们需要手动修改，修改完之后提交修改即可完成最终的合并（当然，这里的 abc 文件也可以不修改就直接add 然后提交，这样将按照 git 自动合并后的内容提交，不过这样好像没啥意义）

```shell
$ vim abc 
...(手动编辑冲突内容)
$ git commit -a -m "master,解决冲突后提交"
```

执行 git log 查看 master 分支下的日志如下：

```Shell
XXX:test XXX$  git log
commit e574f5f8376b4ea79a2caa088c7203843a24e13d
Merge: 29126cf b0e134a
Author: XXX
Date:   Fri Aug 25 21:25:37 2017 +0800

    master,解决冲突后提交

commit b0e134ad5319aa0a15962bac3c131511cf5c4f71
Author: XXX
Date:   Fri Aug 25 21:14:59 2017 +0800

    work,第二次修改 abc

commit 29126cf151b4b195030004ffd223ddf81b1bfa69
Author: XXX
Date:   Fri Aug 25 21:02:43 2017 +0800

    hotfix 修改 abc

commit 3197d9d6a52a5f7256f95cb3ac909a4e91228f64
Author: XXX
Date:   Fri Aug 25 20:51:24 2017 +0800

    work第一次修改abc

commit a1adf68e4082b7b8bb033271c11db38a3430dc6f
Author: XXX
Date:   Fri Aug 25 20:24:12 2017 +0800

    master,创建 abc
```

 这就跟我们所有的修改顺序一致了。最后说一点，如果合并后，我们切换到 work 分支，查看 log 或者 abc 文件可以发现，work 分支保存的只是第一次创建分支时和在该分支修改的内容，即合并没有影响到 work 的内容，我们只是将 work 的修改合并到了 master。

最后的最后，我又试了下，在 work 分支执行 git merge 将 master 合并到 work，直接就成功了，并没有发生冲突问题，呃。。。（凌乱）。。。看来自己对 Git 的工作原理还是不是十分了解，不过一般人也不会这样操作吧，如果需要继续开发，在 work 内容合并到 master 后，应该是删掉  work 分支，然后新建分支来继续开发才对，我想。。。





参考内容：

[Git 分支 - 分支的新建与合并](https://git-scm.com/book/zh/v1/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%9A%84%E6%96%B0%E5%BB%BA%E4%B8%8E%E5%90%88%E5%B9%B6)