---
title: 输入法相关类
tags:
  - android
  - 输入法
date: 2017-05-25 15:37:22
categories: 笔记
---

## InputMethodSubtype

​	subtype，子类，每个 IME 都会包含至少一个 subtype，而 InputMethodSubtype 类正是用来表示 IME 中subtype 的元信息的类。subtype 可以描述 locale（区域，如 en_US、fr_FR 等）和 mode （如 voice、keyboard等），还可用于 IME 开关和设置。

​	InputMethodSubtype 作为 \<subtype\> 元素定义在 XML 资源文件中，而 \<subtype> 包含在 \<input-method> 元素中。

在 \<subtype> 标签中可使用的属性有

```xml
<declare-styleable name="InputMethod_Subtype">
        <attr name="label" />
        <attr name="icon" />
        <!-- 区域，如 en_US, fr_FR等，当framework使用该subtype调用IME时也会将subtype传递给IME，该属性同时还
             可以让framework知道IME支持的locale  -->
        <attr name="imeSubtypeLocale" format="string" />
        <!-- 如 voice, keyboard 等，当framework使用该subtype调用IME时，会将该 string传给IME -->
        <attr name="imeSubtypeMode" format="string" />
        <!-- 该subtype 是否是辅助的。辅助的subtype不会出现在设置应用的输入法选择列表。
             InputMethodManager 的 switchToLastInputMethod 也会忽略辅助的subtype -->
        <attr name="isAuxiliary" format="boolean" />
        <!-- true表示如果没有显示选择其他的subtype则将此subtype作为默认选择。
             注意：该参数为 true 的 subtype 不会显示在 subtype 列表中 -->
        <attr name="overridesImplicitlyEnabledSubtype" format="boolean" />
        <!-- 该string可以为任意字符串，在framework调用使用该subtype调用IME时，会将它传给IME。  -->
        <attr name="imeSubtypeExtraValue" format="string" />
        <!-- 该 subtype 的唯一 ID。 输入法框架通过 ID 来跟踪可用的subtype。
             在IME包升级时，enabled 的 ID仍会保持为enabled。如果未指定，
			 则会使用
             Arrays.hashCode(new Object[] {locale, mode, extraValue,
             isAuxiliary, overridesImplicitlyEnabledSubtype}) -->
        <attr name="subtypeId" format="integer"/>
        <!-- 该 subtype 是否支持 ASCII 。 -->
        <attr name="isAsciiCapable" format="boolean" />
    </declare-styleable>
```



## InputMethodInfo

​	该类用来表示输入法的元信息。InputMethodInfo 作为 \<input-method> 元素定义在 XML 资源文件中。

\<input-method> 支持的属性

```xml
    <declare-styleable name="InputMethod">
        <!-- 允许用户修改该 service 设置的 activity -->
        <attr name="settingsActivity" format="string" />
        <!-- Set to true in all of the configurations for which this input
             method should be considered an option as the default. -->
        <attr name="isDefault" format="boolean" />
        <!-- 该输入法是否支持切换到下一输入法（如，一个globe全球键）。
 		     为 true 时，InputMethodManager 的 shouldOfferSwitchingToNextInputMethod() 返回 true，
			 因此该IME必须提供调用InputMethodManager#switchToNextInputMethod()的方式
			 注意：系统会决定最恰当的下一个输入法和subtype以提供一致的用户体验。 -->
        <attr name="supportsSwitchingToNextInputMethod" format="boolean" />
    </declare-styleable>
```



### getId

​	表示 InputMethodInfo 的唯一 ID，该 ID 根据包名和类名生成。

```java
mId = new ComponentName(si.packageName, si.name).flattenToShortString();
```

如：com.android.inputmethod.latin/.LatinIME

​	修改系统默认输入法最终使用的也是该ID

```java
Settings.Secure.putStringForUser(
           mResolver, Settings.Secure.DEFAULT_INPUT_METHOD, imeId, mCurrentUserId);
```