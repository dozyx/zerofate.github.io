---
title: 内存泄露的常见场景
tags:
  - android
  - 内存泄漏
date: 2017-06-24 15:37:22
categories: 笔记
---

[Eight Ways Your Android App Can Leak Memory](http://blog.nimbledroid.com/2016/05/23/memory-leaks.html)

​	最常见的内存泄露基本上都是由于非静态内部类会持有外部类的引用，一开始我很好奇为什么非静态内部类会持有外部类的引用？但想想也没啥奇怪的，如果非静态内部类没有持有外部类的引用，那它怎么能调用外部类的成员。。。

### 静态 Activity

​	最简单的 Activity 泄漏方式是通过在 Activity 的类定义中定义一个静态变量，然后将其设置给在 Activity 中的其他运行实例。如果该引用在 Activity 生命周期结束前没有清理，则 Activity 会泄漏。

示例代码：

```java
void setStaticActivity() {
  activity = this;
}

View saButton = findViewById(R.id.sa_button);
saButton.setOnClickListener(new View.OnClickListener() {
  @Override public void onClick(View v) {
    setStaticActivity();
    nextActivity();
  }
});
```

说明：按个人理解，这里应该表示的是两种情况，一是普通的静态变量，由于其他对象一直持有了该对象导致无法回收；另一种是静态的Activity，因为是static，导致将在整个应用运行期间存活。