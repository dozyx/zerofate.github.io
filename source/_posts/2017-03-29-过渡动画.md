---
title: Fragment - 过渡动画
tags:
  - android
  - fragment
date: 2017-03-29 15:37:22
categories: 笔记
---

## 自带动画

​	在FragmentTransaction类中定义了几个自带动画：

```java
//用于进入切换的位掩码
public static final int TRANSIT_ENTER_MASK = 0x1000;
//用于退出切换的位掩码
public static final int TRANSIT_EXIT_MASK = 0x2000;
/** Not set up for a transition. */
public static final int TRANSIT_UNSET = -1;
/** No animation for transition. */
public static final int TRANSIT_NONE = 0;
/** Fragment is being added onto the stack */
public static final int TRANSIT_FRAGMENT_OPEN = 1 | TRANSIT_ENTER_MASK;
/** Fragment is being removed from the stack */
public static final int TRANSIT_FRAGMENT_CLOSE = 2 | TRANSIT_EXIT_MASK;
/** Fragment should simply fade in or out; that is, no strong navigation associated
 * with it except that it is appearing or disappearing for some reason. */
public static final int TRANSIT_FRAGMENT_FADE = 3 | TRANSIT_ENTER_MASK;
```



#### TRANSIT_FRAGMENT_FADE

٩(๑`н´๑)۶ragment_fade_enter.xml

```xml
<set xmlns:android="http://schemas.android.com/apk/res/android">
    <objectAnimator
        android:interpolator="@interpolator/decelerate_cubic"
        android:valueFrom="0"
        android:valueTo="1"
        android:valueType="floatType"
        android:propertyName="alpha"
        android:duration="@android:integer/config_activityDefaultDur"/>
</set>
```

`config_activityDefaultDur`的值在Android 7.1.1 中为220。



fragment_fade_exit.xml

```xml
<set xmlns:android="http://schemas.android.com/apk/res/android">
    <objectAnimator
        android:interpolator="@interpolator/decelerate_cubic"
        android:valueFrom="1"
        android:valueTo="0"
        android:valueType="floatType"
        android:propertyName="alpha"
        android:duration="@android:integer/config_activityShortDur"/>
</set>
```

`config_activityShortDur`的值在Android 7.1.1中为150。



### 源码分析

`FragmentManager.java`

​	Fragment创建时进行动画加载：

```java
	case Fragment.CREATED:
			...
			f.mContainer = container;
                    f.mView = f.performCreateView(f.getLayoutInflater(
                            f.mSavedFragmentState), container, f.mSavedFragmentState);
                    if (f.mView != null) {
                        f.mView.setSaveFromParentEnabled(false);
                        if (container != null) {
                            Animator anim = loadAnimator(f, transit, true,
                                    transitionStyle);
                            if (anim != null) {
                                anim.setTarget(f.mView);
                                anim.start();
                            }
                            container.addView(f.mView);
                        }
                        if (f.mHidden) f.mView.setVisibility(View.GONE);
                        f.onViewCreated(f.mView, f.mSavedFragmentState);
                    }
			...
```

​	从上面代码可以看出，Fragment的过渡动画作用的是Fragment的mView对象，该对象由onCreateView返回。