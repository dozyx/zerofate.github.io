---
title: git 基本用法
tags:
  - git
date: 2016-10-19 15:37:22
categories: 笔记
---

[git book](https://git-scm.com/book/en/v2)

### 设置别名 ###
使用git命令行
> $ git config --global alias.st status 

unix下如果带空格需要添加单引号
> $ git config --global alias.ci 'commit -v'

Windows下如果带有空格或者命令行参数则需要添加双引号
> $ git config --global alias.ci "commit -v"

#### 常用

[参考](https://gist.github.com/igal/53855)

```shell
# Aliases for common git commands. E.g., enter "git d" for "git diff"
# These settings live in the ~/.gitconfig file.

[alias]
	b = branch
	ba = branch -a
	ci = commit
	co = checkout
	d = diff
	dc = diff --cached
	fp = format-patch
	g = !git gui &
	gr = log --graph
	go = log --graph --pretty=oneline --abbrev-commit
	k = !gitk &
	ka = !gitk --all &
	lc = log ORIG_HEAD.. --stat --no-merges
	lp = log --patch-with-stat
	mnf = merge --no-ff
	mnff = merge --no-ff
	mt = mergetool
	p = format-patch -1
	serve = !git daemon --reuseaddr --verbose  --base-path=. --export-all ./.git
	sra = svn rebase --all
	sh = !git-sh
	st = status
	stm = status --untracked=no
	stfu = status --untracked=no
	pullsrb = !git stash save && git pull --rebase && git stash pop && echo 'Success!'
```

也可以直接设置bash别名~/.bashrc，该文件为隐藏文件，可以直接在主目录下使用ls -a查看，或者直接使用vim ~/.bashrc修改

```shell
alias b="git branch"
alias ba="git branch -a"
alias ci="git commit"
alias co="git checkout"
alias d="git diff"
alias dc="git diff --cached"
alias fp="git format-patch"
alias g="git !git gui &"
alias gr="git log --graph"
alias go="git log --graph --pretty=oneline --abbrev-commit"
alias k="git !gitk &"
alias ka="git !gitk --all &"
alias lc="git log ORIG_HEAD.. --stat --no-merges"
alias lp="git log --patch-with-stat"
alias mnf="git merge --no-ff"
alias mnff="git merge --no-ff"
alias mt="git mergetool"
alias p="git format-patch -1"
alias serve="git !git daemon --reuseaddr --verbose --base-path=. --export-all ./.git"
alias sra="git svn rebase --all"
alias sh="git !git-sh"
alias st="git status"
alias stm="git status --untracked=no"
alias stfu="git status --untracked=no"
alias pullsrb="git !git stash save && git pull --rebase && git stash pop && echo 'Success!'"
```



### 撤销修改

`git checkout`

git checkout file-name撤销某个文件的修改

git checkout *.java撤销所有java文件的修改

git checkout . 撤销所有修改

`git revert`

撤销某次操作，此次之前和之后的commit和history都会保留，并且把这次撤销作为最新一次的提交

git revert HEAD撤销前一次commit

git revert HEAD^撤销前前一次commit

git revert commit -id撤销指定的版本



## git checkout

### 功能

​	切换分支或恢复工作树文件（working tree）文件

### 大纲SYNOPSIS

```shell
git checkout [-q] [-f] [-m] [<branch>]
git checkout [-q] [-f] [-m] --detach [<branch>]
git checkout [-q] [-f] [-m] [--detach] <commit>
git checkout [-q] [-f] [-m] [[-b|-B|--orphan] <new_branch>] [<start_point>]
git checkout [-f|--ours|--theirs|-m|--conflict=<style>] [<tree-ish>] [--] <paths>…
git checkout [-p|--patch] [<tree-ish>] [--] [<paths>…]
```

### 说明DESCRIPTION

> 如果git checkout后没有路径，则会将HEAD作为当前分支。

#### git checkout \<branch>

​	通过更新工作树的索引和文件并将`HEAD`指向该branch进行切换，准备在\<branch>分支上进行工作。==工作树中被修改的本地文件将会保留==，这样他们仍可以被上传到\<branch\>。

​	如果\<branch\>找不到但在远程端确实存在一个相同名称的跟踪分支(tracking branch)，则可以使用如下处理：

`$ git checkout -b <branch> --track <remote>/<branch>`

#### git checkout -b|-B \<new_branch\> [\<start point\>]

​	指定`-b`将导致创建一个新的分支，等同于执行了`git branch`然后再check out。此处用法还可以将`--track`和`--no-track`选项传递给git branch。

​	如果指定了`-B`，分支不存在则会创建，存在则重置，等同于：

```shell
$ git branch -f <branch> [<start point>]
$ git checkout <branch>
```

#### git checkout --detach [\<branch\>]和git checkout [--detach] \<commit\>

​	通过分离（detach）HEAD并且更新工作树的索引和文件，准备在\<commit\>上进行工作。==工作树中被修改的本地文件将会保留==，这样最终的工作树的状态记录将为commit加上本地修改。

​	如果\<commit\>参数为branch名，`--detach`选项将用来分离branch顶端的HEAD（`git checkout <branch>`会check out该branch但不会分离HEAD）。

​	省略\<branch\>将会分离当前分支顶端的HEAD。

#### git checkout \[-p\|\-\-patch\]\[\]\[\-\-\] \<pathspec\>…

​	当提供了\<paths\>或`--patch`，*git checkout*将不会切换分支。它将根据索引文件或者\<tree-ish\>（通常为一个commit）更新工作树中指定路径的文件。\<tree-ish\>可以用来指定一个特定的tree-ish（如commit、tag或者tree）。

​	带有\<paths\>或`--patch`的*git checkout*用来恢复被修改或被删除路径下的原始内容（根据tree-ish）。

### 选项OPTIONS







## git log

[Viewing the Commit History](https://git-scm.com/book/en/v2/Git-Basics-Viewing-the-Commit-History)

#### 常见用法

`git log`

将按提交时间的倒序来显示仓库的提交

##### -p -(n)

`git log -p -2`

-p显示每次提交的差别，-2将输出记录限制为最后提交的两条

##### --stat

`git log --stat`

--stat查看每次提交的简略统计

##### --pretty

`git log --pretty=oneline`

将输入log格式化为其他形式，oneline表示将每一次提交打印为一行。除此之外还有其他如short、full、fuller等选项(可在输入时点击tab查看)。

`$ git log --pretty=format:"%h - %an, %ar : %s"`

指定log输出格式

常见的选项有

|  选项  |           描述            |
| :--: | :---------------------: |
|  %H  | 提交记录的hash值（commit hash） |
|  %h  |        简短的hash值         |
|  %T  |   树的hash值（tree hash）    |
|  %t  |           简短            |
|  %P  |  父hash值（parent hashes）  |
|  %p  |           简短            |
| %an  |    作者名字（author name）    |
| %ae  |   作者邮箱（author email）    |
| %ad  |    作者日期（author date）    |
| %ar  | 作者相对的（relative）日期：多少天前  |
| %cn  |  提交者名字（committer name）  |
| %ce  | 提交者邮箱（committer email）  |
| %cd  |  提交日期（committer date）   |
| %cr  |        提交者相对的日期         |
|  %s  | 主题（subject）：个人理解为提交内容说明 |

`git log --pretty=format:"%h %s" --graph`

##### --graph

--graph以ASCII图表形式来显示历史记录

#### options

##### 输出格式

除了以上的常用的选项外，git log还能有其他的输出格式选项：

| 选项              | 描述                                       |
| :-------------- | :--------------------------------------- |
| -p              | 显示每次的patch说明                             |
| --stat          | 显示每次提交的文件修改统计                            |
| --shortstat     | 只显示--stat执行中的changed/insertions/deletions行 |
| --name-only     | 在commit信息后面显示修改的文件的列表                    |
| --name-status   | 在文件上显示added/modified/deleted信息(文件名前显示A/M/D) |
| --abbrev-commit | 显示SHA-1校验值得前几个字符，而不是全部40位                |
| --relative-date | 以相对的格式显示日期(如“2 weeks ago”)               |
| --graph         | 显示ASCII图表                                |
| --pretty        | 以其他格式显示提交                                |

##### log输出限制

`git log -<n>`

限制输入数目，n为任意整数

`git log --since=2.weeks`

上两周的提交。还可以使用其他日期形式，如`2008-01-15`特定日期，`2 years 1day 3minutes ago`相对日期。



使用`--author`过滤指定的author，`--grep`搜索提交信息中的关键字(如果想要同时指定author和grep选项，需要添加`--add-match`或者其他可以彼此匹配提交的指令？)。



`git log -Sfunction_name`

显示提交中改变了function_name方法的提交。-S过滤提交中对指定字符串修改的提交。



如果在git log中指定目录或者文件，则可以限制log为对应的文件。该选项通常放在指令的最后。

限制git log输出的option有：

| 选项                | 描述                     |
| ----------------- | ---------------------- |
| -(n)              | 限制数量                   |
| --since, --after  | 限制日期                   |
| --until, --before | 限制日期                   |
| --author          | 限制author               |
| --committer       | 限制committer            |
| --grep            | 限制commit messages      |
| -S                | 限制添加或者移除的code中匹配指定的字符串 |



### 搜索

[Git Tools - Searching](https://git-scm.com/book/en/v2/Git-Tools-Searching)

#### git grep

默认会搜索工作目录下的

`git grep -n gmtime_r`

==-n==输出显示行数

`git grep --count gmtime_r`

==--count==只输出匹配的数目

`git grep -p gmtime_r *.c`

==-p==查看匹配内容所在的方法

`git grep --break --heading \-n -e "#include" --and \( -e LINK -e BUF_MAX \) v1.8.0`

==--break== ==--heading==以更可读的方式将输出分开，==--and==对同一行进行多处匹配（如上面的命令表示同一行中保存#include和LINK或者#include和BUF_MAX），==-e==表示下一个参数是一个格式，v1.8.0指定搜索的源码的版本

#### git log搜索

`git log -SZLIB_BUF_MAX --oneline`

==-S==显示ZLIB_BUF_MAX添加或者移除的commit，还可以通过指定==-G==来使用正则表达式搜索

`git log -L :git_deflate_bound:zlib.c`

==-L==查看对zlib.c文件中git_deflate_bound方法的每一次修改



### 本地仓库与github建立联系（SSH密钥）

参考

[Generating an SSH key](https://help.github.com/articles/generating-an-ssh-key/)

SSH(Secure Shell)密钥是用来识别不需要密码的的信任计算机的一种方法。

1. 检查是否已存在ssh key

   ```shell
   $ ls -al ~/.ssh	
   # Lists the files in your .ssh directory, if they exist
   ```

2. 生成新ssh key并添加到ssh-agent

   ```shell
   $ ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
   # "your_email@example.com"为github注册邮箱
   # 提示"Enter a file in which to save the key," 时直接回车，使用默认的文件生成路径
   # 提示输入密码，为空则不设置（此密码看完文档说明还不是很明白，用于确认使用ssh key的用户是否合法？）
   ```

3. 将新的ssh key添加到github账户

   ```shell
   $ clip < ~/.ssh/id_rsa.pub
   # 将ssh key复制到剪切板，也可以直接使用编辑器打开文件进行复制
   ```

   最后，在[github设置](https://github.com/settings/keys)中添加key