---
title: Fragment - 返回栈及其回收时机
tags:
  - android
  - fragment
date: 2017-03-08 15:37:22
categories: 笔记
---

[When a Fragment is replaced and put in the back stack (or removed) does it stay in memory?](http://stackoverflow.com/questions/8482606/when-a-fragment-is-replaced-and-put-in-the-back-stack-or-removed-does-it-stay)

[BackStackRecord.Op.fragment](http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/4.0.1_r1/android/app/BackStackRecord.java#BackStackRecord.Op.0fragment)

[FragmentManagerImpl.mBackStack](http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/4.0.1_r1/android/app/FragmentManager.java#FragmentManagerImpl.0mBackStack)

[Activity.mFragments](http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/4.0.3_r1/android/app/Activity.java#Activity.0mFragments)

参考中的一些结论

1. GC不会回收back stack中的fragment，直到activity被销毁。
2. fragment被放入返回栈时，onDestroyView()会被调用，只要在这个节点将fragment中主要的内存占用清理掉，将不会有内存问题
3. non-backstack的保留（retained，setRetainInstance（true））fragment即使在activity因配置改变而重新创建时也不会销毁。







`setTetainInstance(boolean)`

​	控制一个fragment实例是否在activity重建过程（如配置改变）中保留下来，该方法只能对不在back stack中的fragment使用。设置了该属性的fragment的生命周期将在activity重建时产生差别：onDestroy()不会被调用，但onDetach()会；onCreate()也不会被回调，但onAttach(Activity)和onActivityCreated(Bundle)会。