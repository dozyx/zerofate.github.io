---
title: 匿名类
tags:
  -  java
date: 2017-06-24 15:37:22
categories: 笔记
---

​	[Anonymous Classes Oracle](https://docs.oracle.com/javase/tutorial/java/javaOO/anonymousclasses.html)

​	[Statements in anonymous class declaration](https://stackoverflow.com/questions/34333866/statements-in-anonymous-class-declaration)

​	匿名类的作用在于使代码更为简洁，使用匿名类可以在同一时刻对一个类进行声明和实例化。**匿名类除了没有名字外，与本地类（local class）是一样的。**如果仅需要使用一个类一次，可以使用匿名类，而不是写一个本地类。

### 声明匿名类

​	**local class是一个类声明，而匿名类只是一个表达式**（在一个表达式中进行定义）。	

示例代码：

```java
public class HelloWorldAnonymousClasses {
  
    interface HelloWorld {
        public void greet();
        public void greetSomeone(String someone);
    }
  
    public void sayHello() {
        
        class EnglishGreeting implements HelloWorld {//本地类
            String name = "world";
            public void greet() {
                greetSomeone("world");
            }
            public void greetSomeone(String someone) {
                name = someone;
                System.out.println("Hello " + name);
            }
        }
      
        HelloWorld englishGreeting = new EnglishGreeting();
        
        HelloWorld frenchGreeting = new HelloWorld() {//匿名类
            String name = "tout le monde";
            public void greet() {
                greetSomeone("tout le monde");
            }
            public void greetSomeone(String someone) {
                name = someone;
                System.out.println("Salut " + name);
            }
        };
        
        HelloWorld spanishGreeting = new HelloWorld() {//匿名类
            String name = "mundo";
            public void greet() {
                greetSomeone("mundo");
            }
            public void greetSomeone(String someone) {
                name = someone;
                System.out.println("Hola, " + name);
            }
        };
        englishGreeting.greet();
        frenchGreeting.greetSomeone("Fred");
        spanishGreeting.greet();
    }

    public static void main(String... args) {
        HelloWorldAnonymousClasses myApp =
            new HelloWorldAnonymousClasses();
        myApp.sayHello();
    }            
}
```

### 匿名类语法

示例代码：

```java
HelloWorld frenchGreeting = new HelloWorld() {
            String name = "tout le monde";
            public void greet() {
                greetSomeone("tout le monde");
            }
            public void greetSomeone(String someone) {
                name = someone;
                System.out.println("Salut " + name);
            }
        };
```

一个匿名类是一个表达式，该表达式包括：

+ new 操作符
+ 将要实现的 interface 的名称或者将要继承的 class 的名称
+ 包含在小括号中传给构造函数的参数
+ body，类声明体。更具体地，在 body 中，可以进行方法声明，但不能使用语句。（More specifically, in the body, method declarations are allowed but statements are not.）

> 示例中的 name 只是定义+初始化，并不是statement，需要注意声明和语句的区别，如`i++`、方法调用都是不允许的。

### 作用域的本地变量访问以及匿名类成员声明和访问

​	匿名类对作用域的本地变量的访问与本地类一样：

+ 匿名类可以访问外部类的成员

+ 匿名类无法访问作用域内不是 final 或 effectively final (A variable or parameter whose value is never changed after it is initialized is effectively final)的本地变量。如：

  ```java
  public class Test{
  	interface IHello{
  		public void say();
  	}
  	private void foo(){
  		String name = new String();
  		name = new String("1");
  		IHello hello = new IHello(){
  			public void say(){
  				name.toString();//这里会报错 ，因为name不是final
  				//如果 name = new String("1"); 屏蔽，则不会报错，因此name只经过一次初始化，
                	//在Java 8中将被视作 effectively final，这个可能跟Java 版本有关，未验证
  			}
  		};
  		hello.say();
  	}
  	
  	public static void main(String[] args){
  		new Test().foo();	
  	}
  }
  ```

+ 与内部类一样，匿名类的同名变量将覆盖作用域(enclosing scope)的变量



​	匿名类的成员具有与本地类一样的限制：

+ 不能在匿名类中声明静态块或成员接口
+ 匿名类可以有常量静态成员



​	匿名类中可以声明的内容有：

+ 字段

+ 额外的方法(不是从父类继承的方法)

+ instance initializers（形式上与static块类似，但没有static修饰），因为匿名类不能声明构造方法，所以可以在此进行初始化

+ 本地类

  但是，不能在匿名类中声明构造函数







