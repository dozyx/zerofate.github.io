---
title: 自定义文字闪烁的 TextView
tags:
  - android
date: 2017-03-06 15:37:22
categories: 笔记
---

参考

《Android群英传》



思路：定义颜色不断变化的Shader渲染器，然后设置给Paint对象，再用该Paint来绘制要显示的文字，并通过矩阵的方式来不断平移渐变效果。实际上是一段渐变色带在移动。

```java
public class ShineTextView extends TextView {

    private LinearGradient mLinearGradient;
    private Matrix mGradientMatrix;
    private Paint mPaint;
    private int mViewWidth = 0;
    private int mTranslate = 0;

    public ShineTextView(Context context, AttributeSet attrs) {
        super(context, attrs);
    }

    @Override
    protected void onSizeChanged(int w, int h, int oldw, int oldh) {
        super.onSizeChanged(w, h, oldw, oldh);
        if (mViewWidth == 0) {//初始化
            mViewWidth = getMeasuredWidth();
            if (mViewWidth > 0) {
                mPaint = getPaint();//获取默认的Paint
                mLinearGradient = new LinearGradient(
                        0,
                        0,
                        mViewWidth / 2,
                        0,
                        new int[]{
                                Color.BLUE, Color.WHITE,
                                Color.BLUE},
                        null,
                        Shader.TileMode.CLAMP);//变化的位置从(0, 0)到(mViewWidth/2, 0),为相对于matrix的位置
                                                //CLAMP表示超出边界的部分将以边沿颜色进行绘制,
                                                // 此处边沿均为蓝色
                mPaint.setShader(mLinearGradient);//设置Shader属性
                mGradientMatrix = new Matrix();
            }
        }
    }

    @Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);
        if (mGradientMatrix != null) {
            mTranslate += mViewWidth / 5;//计算矩阵移动位置
            if (mTranslate > 2 * mViewWidth) {//超过2倍mViewWidth后，将矩阵移动到-mViewWidth，开始下一轮
                mTranslate = -mViewWidth;//故变化有三段：[-mViewWidth，0][0, mViewWidth][mViewWidth,
              							//2*mViewWidth]
            }
            mGradientMatrix.setTranslate(mTranslate, 0);
            mLinearGradient.setLocalMatrix(mGradientMatrix);
            postInvalidateDelayed(100);//每间隔100ms重绘，配合矩阵移动实现闪烁效果
        }
    }
}
```

